%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#EA580C', 'primaryTextColor': '#fff', 'lineColor': '#F97316'}}}%%

flowchart LR
    subgraph Producers["ğŸ“¤ Event Producers"]
        direction TB
        CandidateSvc["ğŸ‘¤ Candidate Service"]
        RecruiterSvc["ğŸ‘” Recruiter Service"]
        DocSvc["ğŸ“ Document Service"]
        InterviewSvc["ğŸ™ï¸ Interview Bot"]
    end

    subgraph KafkaCluster["Apache Kafka Cluster"]
        direction TB
        
        subgraph Topics["ğŸ“‹ Topics"]
            direction TB
            
            subgraph CandidateTopics["Candidate Domain"]
                T1["candidate.applications<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>New applications,<br/>status changes"]
                T2["candidate.profiles<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Profile updates,<br/>resume uploads"]
            end
            
            subgraph JobTopics["Job Domain"]
                T3["job.postings<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>New jobs, updates,<br/>closures"]
                T4["job.matches<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>AI matching results,<br/>recommendations"]
            end
            
            subgraph ProcessingTopics["Processing Queues"]
                T5["resume.parsing.queue<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Resumes to parse<br/>(AI processing)"]
                T6["ranking.queue<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Candidates to rank<br/>against jobs"]
            end
            
            subgraph SystemTopics["System Events"]
                T7["notifications.outbound<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Emails, SMS,<br/>push notifications"]
                T8["audit.events<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Compliance trail,<br/>user actions"]
            end
        end
        
        subgraph KafkaFeatures["âš™ï¸ Kafka Features"]
            SR["Schema Registry<br/>(Avro/JSON Schema)"]
            CG["Consumer Groups<br/>with Offset Tracking"]
            DLQ["Dead Letter Queue<br/>for Failed Messages"]
        end
    end

    subgraph Consumers["ğŸ“¥ Event Consumers"]
        direction TB
        
        subgraph AIConsumers["ğŸ¤– AI Services"]
            ResumeParser["Resume Parser<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Consumes: resume.parsing.queue<br/>Produces: candidate.profiles"]
            RankingSvc["Ranking Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Consumes: ranking.queue<br/>Produces: job.matches"]
        end
        
        subgraph NotifyConsumers["ğŸ”” Notification"]
            NotifySvc["Notification Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Consumes: notifications.outbound<br/>Sends: Email/SMS/Push"]
        end
        
        subgraph AnalyticsConsumers["ğŸ“Š Analytics"]
            AnalyticsSvc["Analytics Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Consumes: ALL topics<br/>Builds: Dashboards, Reports"]
        end
        
        subgraph AuditConsumers["ğŸ“ Audit"]
            AuditSvc["Audit Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Consumes: audit.events<br/>Stores: Compliance logs"]
        end
    end

    %% Producer connections
    CandidateSvc --> T1
    CandidateSvc --> T2
    RecruiterSvc --> T3
    DocSvc --> T5
    InterviewSvc --> T8

    %% Consumer connections
    T5 --> ResumeParser
    T6 --> RankingSvc
    T7 --> NotifySvc
    T1 --> AnalyticsSvc
    T3 --> AnalyticsSvc
    T8 --> AuditSvc

    %% Cross-service event flows
    ResumeParser -.->|"Parsed data"| T2
    RankingSvc -.->|"Match scores"| T4
    T1 -.->|"Trigger ranking"| T6
    T1 -.->|"Notify recruiter"| T7

    %% Styling
    classDef producerStyle fill:#DBEAFE,stroke:#2563EB,stroke-width:2px
    classDef topicStyle fill:#FFF7ED,stroke:#EA580C,stroke-width:2px
    classDef consumerStyle fill:#D1FAE5,stroke:#059669,stroke-width:2px
    classDef featureStyle fill:#F3F4F6,stroke:#6B7280,stroke-width:1px
    
    class CandidateSvc,RecruiterSvc,DocSvc,InterviewSvc producerStyle
    class T1,T2,T3,T4,T5,T6,T7,T8 topicStyle
    class ResumeParser,RankingSvc,NotifySvc,AnalyticsSvc,AuditSvc consumerStyle
    class SR,CG,DLQ featureStyle
