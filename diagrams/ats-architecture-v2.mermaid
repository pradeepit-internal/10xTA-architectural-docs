%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4F46E5', 'primaryTextColor': '#fff', 'primaryBorderColor': '#3730A3', 'lineColor': '#6366F1', 'secondaryColor': '#F0FDFA', 'tertiaryColor': '#EEF2FF'}}}%%

flowchart TB
    subgraph Clients["ğŸŒ Client Applications"]
        direction LR
        WebApp["ğŸ–¥ï¸ Web Application<br/>(React/Angular)"]
        MobileApp["ğŸ“± Mobile App<br/>(iOS/Android)"]
        ThirdParty["ğŸ”— Third-Party<br/>Integrations"]
    end

    subgraph IDP["ğŸ” Identity Provider Layer"]
        direction LR
        AzureAD["Azure AD External ID<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Social Login (LinkedIn, Google)<br/>â€¢ Enterprise SSO (SAML/OIDC)<br/>â€¢ MFA Support<br/>â€¢ Custom Policies"]
        Cognito["AWS Cognito<br/>(Alternative)<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ User Pools<br/>â€¢ Identity Pools<br/>â€¢ Federation"]
    end

    subgraph Gateway["ğŸšª API Gateway Layer"]
        SCG["Spring Cloud Gateway<br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>ğŸ”‘ <b>Authentication</b><br/>â€¢ JWT Validation<br/>â€¢ Token Introspection<br/>â€¢ Session Management<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>ğŸ›¡ï¸ <b>Authorization</b><br/>â€¢ Role-Based Access (RBAC)<br/>â€¢ Tenant Context Injection<br/>â€¢ Permission Validation<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>ğŸ”€ <b>Routing</b><br/>â€¢ Dynamic Route Resolution<br/>â€¢ Load Balancing<br/>â€¢ Rate Limiting<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>ğŸ“¦ <b>Caching</b><br/>â€¢ Master Data Cache (Redis)<br/>â€¢ Tenant Config Cache<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>ğŸ“„ <b>API Aggregation</b><br/>â€¢ OpenAPI/Swagger Aggregation<br/>â€¢ API Documentation Portal"]
    end

    subgraph Services["âš™ï¸ Microservices Layer"]
        direction TB
        
        subgraph BusinessServices["ğŸ“Š Business Domain Services"]
            direction LR
            CandidateSvc["ğŸ‘¤ Candidate Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Profile Management<br/>â€¢ Application Tracking<br/>â€¢ Candidate Search<br/>â€¢ Talent Pool"]
            RecruiterSvc["ğŸ‘” Recruiter Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Job Management<br/>â€¢ Pipeline Management<br/>â€¢ Interview Scheduling<br/>â€¢ Hiring Workflows"]
        end
        
        subgraph TechnicalServices["ğŸ”§ Technical Services"]
            direction LR
            TenantSvc["ğŸ¢ Tenant Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Tenant Provisioning<br/>â€¢ Schema Management<br/>â€¢ Tenant Isolation<br/>â€¢ Billing Integration"]
            DocMgmtSvc["ğŸ“ Document Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ File Upload/Download<br/>â€¢ SAS URL Generation<br/>â€¢ Version Control<br/>â€¢ Azure Blob Storage"]
            NotificationSvc["ğŸ”” Notification Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Email (SendGrid/SES)<br/>â€¢ SMS<br/>â€¢ Push Notifications<br/>â€¢ In-App Alerts"]
            ConfigSvc["âš™ï¸ Config Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Feature Flags<br/>â€¢ Tenant Settings<br/>â€¢ System Configuration<br/>â€¢ Spring Cloud Config"]
        end
        
        subgraph AIServices["ğŸ¤– AI/ML Services"]
            direction LR
            ResumeParser["ğŸ“„ Resume Parser<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ PDF/DOCX Extraction<br/>â€¢ NLP Processing<br/>â€¢ Structured Data Output<br/>â€¢ Skills Extraction"]
            CandidateRanking["ğŸ“ˆ Ranking Service<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Job-Candidate Match<br/>â€¢ Scoring Algorithm<br/>â€¢ Skill Gap Analysis<br/>â€¢ Recommendation Engine"]
            BotInterview["ğŸ™ï¸ Interview Bot<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Conversational AI<br/>â€¢ Question Generation<br/>â€¢ Response Evaluation<br/>â€¢ Scheduling Automation"]
            VoiceAnalysis["ğŸ¤ Voice Analysis<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Speech-to-Text<br/>â€¢ Sentiment Analysis<br/>â€¢ Communication Skills<br/>â€¢ Interview Transcription"]
        end
    end

    subgraph Infrastructure["ğŸ—„ï¸ Data & Infrastructure Layer"]
        direction TB
        
        subgraph DataLayer["ğŸ’¾ Database Layer"]
            MongoDB[("ğŸƒ MongoDB<br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/><b>Multi-Tenant Architecture</b><br/>One Schema Per Tenant<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ tenant_alpha_db<br/>â€¢ tenant_beta_db<br/>â€¢ tenant_gamma_db<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>Shared Collections:<br/>â€¢ system_config<br/>â€¢ master_data")]
        end
        
        subgraph CacheLayer["âš¡ Cache Layer"]
            Redis[("Redis Cluster<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Session Store<br/>â€¢ API Response Cache<br/>â€¢ Rate Limit Counters<br/>â€¢ Real-time Updates")]
        end
        
        subgraph StorageLayer["â˜ï¸ Storage Layer"]
            BlobStorage[("Azure Blob Storage<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ Resumes<br/>â€¢ Documents<br/>â€¢ Profile Images<br/>â€¢ Interview Recordings")]
        end
        
        subgraph EventStreaming["ğŸ“¨ Event Streaming"]
            Kafka["Apache Kafka / Confluent<br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>ğŸ“‹ <b>Topics</b><br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ candidate.applications<br/>â€¢ candidate.profile.updates<br/>â€¢ job.postings<br/>â€¢ interview.events<br/>â€¢ resume.parsing.queue<br/>â€¢ notifications.outbound<br/>â€¢ audit.trail<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>âš™ï¸ <b>Features</b><br/>â€¢ Message Persistence<br/>â€¢ Consumer Groups<br/>â€¢ Event Replay<br/>â€¢ Exactly-once Semantics<br/>â€¢ Schema Registry (Avro)"]
        end
    end

    subgraph Observability["ğŸ“Š Observability"]
        direction LR
        Logging["ğŸ“ Logging<br/>(ELK/Azure Monitor)"]
        Metrics["ğŸ“ˆ Metrics<br/>(Prometheus/Grafana)"]
        Tracing["ğŸ” Distributed Tracing<br/>(Jaeger/Zipkin)"]
    end

    %% Connections
    Clients --> IDP
    IDP --> Gateway
    Clients --> Gateway
    
    Gateway --> BusinessServices
    Gateway --> TechnicalServices
    Gateway --> AIServices
    
    BusinessServices --> MongoDB
    TechnicalServices --> MongoDB
    AIServices --> MongoDB
    
    BusinessServices --> Redis
    TechnicalServices --> Redis
    Gateway --> Redis
    
    DocMgmtSvc --> BlobStorage
    AIServices --> BlobStorage
    
    %% Kafka connections (event-driven)
    BusinessServices <--> Kafka
    TechnicalServices <--> Kafka
    AIServices <--> Kafka
    
    Services --> Observability

    %% Styling
    classDef clientStyle fill:#DBEAFE,stroke:#2563EB,stroke-width:2px,color:#1E3A8A
    classDef idpStyle fill:#FEF3C7,stroke:#D97706,stroke-width:2px,color:#92400E
    classDef gatewayStyle fill:#D1FAE5,stroke:#059669,stroke-width:2px,color:#065F46
    classDef businessStyle fill:#EDE9FE,stroke:#7C3AED,stroke-width:2px,color:#5B21B6
    classDef techStyle fill:#FEE2E2,stroke:#DC2626,stroke-width:2px,color:#991B1B
    classDef aiStyle fill:#CFFAFE,stroke:#0891B2,stroke-width:2px,color:#155E75
    classDef dataStyle fill:#F3F4F6,stroke:#4B5563,stroke-width:2px,color:#1F2937
    classDef kafkaStyle fill:#FFF7ED,stroke:#EA580C,stroke-width:3px,color:#9A3412
    classDef obsStyle fill:#FCE7F3,stroke:#DB2777,stroke-width:2px,color:#9D174D
    
    class WebApp,MobileApp,ThirdParty clientStyle
    class AzureAD,Cognito idpStyle
    class SCG gatewayStyle
    class CandidateSvc,RecruiterSvc businessStyle
    class TenantSvc,DocMgmtSvc,NotificationSvc,ConfigSvc techStyle
    class ResumeParser,CandidateRanking,BotInterview,VoiceAnalysis aiStyle
    class MongoDB,Redis,BlobStorage dataStyle
    class Kafka kafkaStyle
    class Logging,Metrics,Tracing obsStyle
